# Stage 17 — Guided UX Scope & Definition of Done (Step 1)

## Цель
Зафиксировать рамки внедрения Guided UX без изменения MVP-границ: один интерфейс с двумя режимами плотности подсказок (`Guided`, `Explorer`) и едиными проверяемыми критериями готовности для ключевых экранов.

## 1) Целевая модель UI

### 1.1 Режимы
- **Guided Mode (по умолчанию для first-run):**
  - показывает цель текущего экрана;
  - показывает 1 следующий шаг (`next-step`) и причину, почему это важно;
  - блокирует переход при невыполненных prerequisites и объясняет, что исправить.
- **Explorer Mode:**
  - сохраняет тот же информационный контур (данные, статус, выбранный вариант, фильтры),
  - убирает навязчивые step-by-step блоки,
  - оставляет контекстные подсказки (tooltip/help).

### 1.2 Негативные рамки (out of scope для Stage 17)
- Не меняем core scoring/feasibility/validation логику.
- Не расширяем формат экспортных артефактов сверх уже определённых в MVP.
- Не вводим новые обязательные пользовательские поля профиля, если их нет в текущем контракте.

---

## 2) Definition of Done по экранам

Для каждого экрана DoD считается выполненным только если есть **все** элементы: `goal`, `hints`, `CTA`, `empty state`, `next-step`.

### 2.1 Data status
- [ ] Показан `goal` (проверка целостности и актуальности).
- [ ] Есть `hints` про риск stale/invalid данных.
- [ ] Есть основной `CTA` на переход к профилю.
- [ ] Есть явный `empty/error` сценарий при FAIL/FATAL валидации.
- [ ] `next-step` ведёт в `Profile`, если данные допустимы для продолжения.

### 2.2 Profile
- [ ] Показан `goal` (профиль как ограничения реалистичности).
- [ ] У обязательных полей есть контекстные `hints`.
- [ ] Есть основной `CTA` на Recommendations.
- [ ] Есть `empty/error` (что не заполнено и как исправить).
- [ ] `next-step` активен только при `profile_status=ready`.

### 2.3 Explore
- [ ] Показан `goal` (изучение карты и связей, не ранжирование).
- [ ] Есть `hints` на уровне вкладок/сущностей.
- [ ] Есть `CTA` к применению выбора в Recommendations (где применимо).
- [ ] Есть `empty state` для отсутствующих данных/связей.
- [ ] `next-step` не блокирует общий поток и может быть пропущен в Guided как optional.

### 2.4 Recommendations
- [ ] Показан `goal` (ранжирование под профиль/цель).
- [ ] Есть `hints` для objective/filters/recompute.
- [ ] Есть основной `CTA`: выбрать вариант и перейти к плану.
- [ ] Есть `empty state` с actionable исправлениями фильтров.
- [ ] `next-step` считается выполненным при выборе варианта (`selected_variant_id`).

### 2.5 Plan
- [ ] Показан `goal` (превращение выбора в действия).
- [ ] Есть `hints` по checklist/4-weeks/compliance.
- [ ] Есть основной `CTA` на Export.
- [ ] Есть `empty state`, если вариант не выбран.
- [ ] `next-step` активен только при `plan_ready=true`.

### 2.6 Export
- [ ] Показан `goal` (фиксация воспроизводимого результата).
- [ ] Есть `hints`, что экспорт фиксирует версии данных/правил.
- [ ] Есть `CTA` на выгрузку артефактов.
- [ ] Есть `empty/error` сценарий, если пакет не сформирован.
- [ ] `next-step` завершает guided-flow при `exports_ready=true`.

---

## 3) Обязательные сущности состояния (контракт Stage 17)

- `data_valid: bool`
  - `true` = данные допустимы для продолжения guided-потока.
- `profile_status: "missing" | "draft" | "ready"`
  - `ready` только при заполненных обязательных полях профиля.
- `selected_variant_id: str | null`
  - `null` до явного выбора пользователем в Recommendations.
- `plan_ready: bool`
  - `true`, когда план построен и содержит минимально пригодный набор шагов/структуры.
- `exports_ready: bool`
  - `true`, когда доступны артефакты экспорта (`plan.md`, `result.json`, `profile.yaml`).

## 4) Критерии приёмки этапа (Step 1)
- [ ] Целевая модель `Guided + Explorer` зафиксирована как архитектурная рамка.
- [ ] Для каждого основного экрана зафиксирован единый DoD-шаблон из 5 обязательных блоков.
- [ ] Состояния `data_valid/profile_status/selected_variant_id/plan_ready/exports_ready` зафиксированы как обязательный контракт.
- [ ] Изменение носит рамочный характер (документация/контракт), без изменения требований сверх PDF-спека.

## Spec references
- `Money_Map_Spec_Packet.pdf`: MVP boundaries (p.5), Features/contracts (p.6–7), UX (p.8), DoD/tests (p.14).
- `Блок-схема_старт_разработки_A4_FINAL_v3.pdf`: Release 0.1 quality gates/checklist (p.1).
